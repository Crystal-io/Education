# 02. Declines: причины отказов и работа с ними

## Цель главы

Эта глава посвящена **declines** — отказам в обработке платежей, которые происходят **без технической ошибки**, но приводят к потере депозита и выручки.

После прочтения ты должен:
- чётко понимать, что такое decline и чем он отличается от failure;
- уметь классифицировать declines по уровням;
- понимать, какие declines можно оптимизировать, а какие — нет;
- уметь логически связывать declines с approval rate и conversion;
- говорить о declines как Operations-специалист, а не как саппорт.

---

## 1. Что такое decline (и что им не является)

**Decline** — это отказ в платеже, при котором:
- запрос был технически корректен;
- PSP и банки ответили штатно;
- но транзакция **не была одобрена**.

Важно:
> decline — это **бизнес-отказ**, а не техническая ошибка.

### Не являются declines:
- network timeouts;
- internal server errors;
- invalid signature;
- webhook failures.

Это **failures**, и они разбираются в отдельной главе.

---

## 2. Почему declines — ключевая зона ответственности PSP Ops

Для бизнеса decline = **потерянный депозит**.

При этом:
- продукт может работать идеально;
- интеграция может быть стабильной;
- support может ничего не видеть;

но:
> approval rate падает, и выручка уменьшается.

PSP Account Manager (Operations) — это роль, которая:
- **замечает** рост declines;
- **понимает**, на каком уровне они происходят;
- **работает** с PSP, routing, risk и продуктом для оптимизации.

---

## 3. Классификация declines по уровням

### 3.1. Merchant / Product level

Declines возникают **до передачи в PSP** или из-за параметров запроса.

Типичные причины:
- сумма вне допустимых лимитов;
- валюта не поддерживается методом;
- повторная попытка без idempotency;
- метод оплаты недоступен для данного GEO.

Проявление:
- одинаковые declines на всех PSP;
- высокая повторяемость ошибок;
- отказ происходит мгновенно.

Роль Ops:
- проверить бизнес-правила;
- сверить конфигурации cashier;
- убедиться, что routing не отправляет «невозможные» платежи.

---

### 3.2. PSP level

Declines возникают **на стороне PSP**, до acquirer.

Типичные причины:
- внутренние risk rules PSP;
- превышение лимитов по мерчанту;
- velocity rules;
- временные ограничения по GEO или методу.

Проявление:
- declines концентрируются на одном PSP;
- issuer banks разные, но результат одинаковый;
- PSP часто возвращает generic codes.

Роль Ops:
- запросить breakdown у PSP;
- проверить лимиты и risk rules;
- рассмотреть альтернативный routing или fallback.

---

### 3.3. Acquirer level

Declines происходят на уровне acquiring банка.

Типичные причины:
- превышение лимитов;
- merchant category restrictions;
- local acquiring rules.

Проявление:
- declines по конкретным методам;
- сильная зависимость от GEO;
- резкие изменения после переключения acquirer.

Роль Ops:
- сегментация по GEO / методу;
- сравнение acquirer performance;
- эскалация через PSP с конкретными примерами.

---

### 3.4. Issuer level

Самый распространённый тип declines.

Типичные причины:
- `do not honor`;
- `insufficient funds`;
- card restrictions;
- issuer antifraud.

Проявление:
- высокая вариативность кодов;
- сильная зависимость от банков и стран;
- часто невозможно получить детальные причины.

Роль Ops:
- анализ distribution decline codes;
- выявление паттернов (банки, GEO);
- предложение альтернативных методов оплаты;
- настройка 3DS / risk стратегии.

---

### 3.5. 3DS / SCA level

Declines происходят **после авторизации**, но до финального подтверждения.

Типичные причины:
- клиент не прошёл challenge;
- таймаут 3DS;
- несовместимость устройства.

Проявление:
- approval может быть нормальным;
- conversion резко падает;
- рост abandoned payments.

Роль Ops:
- мониторинг 3DS funnel;
- баланс friction vs risk;
- совместная работа с product/UX.

---

## 4. Soft vs Hard Declines

### Soft declines
- потенциально обратимы;
- можно повторить попытку;
- могут зависеть от тайминга или метода.

Примеры:
- `do not honor`;
- временные issuer ограничения;
- velocity limits.

### Hard declines
- необратимы без изменения параметров;
- повтор приведёт к тому же результату.

Примеры:
- stolen card;
- invalid card number;
- permanent restrictions.

Роль Ops:
> понимать разницу и **не усугублять ситуацию лишними retries**.

---

## 5. Declines и метрики

Основные связи:
- рост declines → падение approval rate;
- issuer declines → снижение LTV;
- 3DS declines → падение conversion;
- PSP-level declines → риск зависимости от одного провайдера.

Важно:
> оптимизация declines — это **постоянный процесс**, а не разовое действие.

---

## 6. Как PSP Ops работает с ростом declines (логика действий)

Типовой подход:
1. Зафиксировать рост (метрика).
2. Сегментировать (PSP / GEO / method / bank).
3. Определить уровень decline.
4. Сформулировать гипотезы.
5. Проверить через данные и PSP.
6. Принять mitigation (routing, rules, UX).
7. Отследить эффект.

Это **аналитическая работа**, а не реакция «по ощущениям».

---

## 7. Key takeaways

- Decline — это не ошибка, а отказ.
- Уровень decline важнее конкретного кода.
- Не все declines можно «починить», но многие — оптимизировать.
- PSP Ops работает с паттернами, а не с единичными кейсами.
- Умение говорить о declines структурно — сильное конкурентное преимущество.

---

## 8. Как использовать эту главу

1. Прочитать и осмыслить классификацию.
2. Попробовать отнести реальные кейсы из опыта к уровням.
3. Перейти в `Quick/declines/*` и использовать чек-листы как практику.
4. На интервью объяснять declines **через уровни**, а не через хаотичный список причин.

Следующая глава: **Failures — технические сбои, timeouts и outages**.
